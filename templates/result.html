<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å®‰å…¨é€‰ä¸¾ç³»ç»Ÿ - é€‰ä¸¾ç»“æœ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #9b59b6, #8e44ad);
            color: white;
            padding: 30px;
            text-align: center;
        }
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            font-weight: 300;
        }
        .election-status {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-top: 20px;
            display: inline-block;
        }
        .main-content {
            padding: 30px;
        }
        .section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin-bottom: 25px;
            border-left: 4px solid #3498db;
            transition: transform 0.3s ease;
        }
        .section:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .section h3 {
            color: #2c3e50;
            margin-bottom: 20px;
            font-size: 1.4em;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            display: none;
        }
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .alert-info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 25px 0;
        }
        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            border-left: 4px solid #3498db;
        }
        .stat-number {
            font-size: 2.5em;
            font-weight: bold;
            color: #3498db;
            margin-bottom: 5px;
        }
        .result-item {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 15px;
            transition: all 0.3s ease;
        }
        .result-item:hover {
            border-color: #3498db;
            transform: translateY(-2px);
        }
        .vote-bar {
            height: 30px;
            background: #e9ecef;
            border-radius: 15px;
            margin: 10px 0;
            overflow: hidden;
            position: relative;
        }
        .vote-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            border-radius: 15px;
            transition: width 0.8s ease-in-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 15px;
            color: white;
            font-weight: bold;
            font-size: 14px;
        }
        .winner-badge {
            background: #e74c3c;
            color: white;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 12px;
            margin-left: 10px;
        }
        .winner-section {
            background: linear-gradient(135deg, #f39c12, #e67e22);
            color: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            margin: 25px 0;
        }
        .winner-name {
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }
        .nav-links {
            text-align: center;
            margin-top: 30px;
        }
        .nav-links a {
            color: #3498db;
            text-decoration: none;
            margin: 0 15px;
            padding: 12px 25px;
            border: 2px solid #3498db;
            border-radius: 25px;
            transition: all 0.3s ease;
            font-weight: 600;
        }
        .nav-links a:hover {
            background: #3498db;
            color: white;
        }
        .verification-section {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            text-align: center;
            border-left: 4px solid #ffc107;
        }
        .btn {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }
        .btn-warning {
            background: linear-gradient(135deg, #ffc107, #e0a800);
        }
        .btn-success {
            background: linear-gradient(135deg, #28a745, #218838);
        }
        .status-badge {
            padding: 5px 10px;
            border-radius: 5px;
            font-weight: bold;
            margin-left: 10px;
        }
        .status-not-started { background: #ffc107; color: #856404; }
        .status-ready { background: #17a2b8; color: white; }
        .status-voting { background: #28a745; color: white; }
        .status-finished { background: #6c757d; color: white; }
        .status-revealed { background: #9b59b6; color: white; }
        .info-box {
            background: #d1ecf1;
            border: 1px solid #bee5eb;
            color: #0c5460;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: center;
        }
        .counting-completed {
            background: #e2e3e5;
            border: 1px solid #d6d8db;
            color: #383d41;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
        }
        .results-not-public {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
        }
        .public-results {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
            text-align: center;
        }
        @media (max-width: 768px) {
            .container {
                margin: 10px;
            }
            .stats-grid {
                grid-template-columns: 1fr;
            }
            .winner-name {
                font-size: 2em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ“Š é€‰ä¸¾ç»“æœ</h1>
            <div class="election-status">
                <h3 id="electionTitle">{{ election_data.title or 'æš‚æ— æ´»åŠ¨çš„é€‰ä¸¾' }}</h3>
                <p id="electionStatus">ç»Ÿè®¡ä¸­...</p>
            </div>
        </div>

        <div class="main-content">
            <!-- æ¶ˆæ¯æç¤º -->
            <div id="successMessage" class="alert alert-success"></div>
            <div id="errorMessage" class="alert alert-error"></div>

            <!-- æŠ•ç¥¨éªŒè¯å…¥å£ -->
            <div class="verification-section">
                <h3>ğŸ” æŠ•ç¥¨éªŒè¯</h3>
                <p>æ‚¨å¯ä»¥éªŒè¯è‡ªå·±çš„æŠ•ç¥¨æ˜¯å¦è¢«æ­£ç¡®è®°å½•å’Œè®¡å…¥ç»“æœ</p>
                <a href="/verify" class="btn btn-warning">å‰å¾€æŠ•ç¥¨éªŒè¯é¡µé¢</a>
                <p><small>è¾“å…¥æ‚¨çš„æŠ•ç¥¨å‡­è¯å“ˆå¸Œå€¼å’Œå­¦å·/å·¥å·å³å¯éªŒè¯</small></p>
            </div>

            <!-- ç»“æœå±•ç¤ºåŒºåŸŸ -->
            <div id="resultContent">
                <!-- ç»“æœå†…å®¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
            </div>

            <!-- å¯¼èˆªé“¾æ¥ -->
            <div class="nav-links">
                <a href="/vote">è¿”å›æŠ•ç¥¨</a>
                <a href="/verify">æŠ•ç¥¨éªŒè¯</a>
            </div>
        </div>
    </div>

    <script>
        let electionData = {{ election_data | tojson }};

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
        window.onload = function() {
            console.log("=== ç»“æœé¡µé¢åŠ è½½å®Œæˆ ===");
            console.log("é€‰ä¸¾æ•°æ®:", electionData);
            updateResultDisplay();
        };

        // æ›´æ–°ç»“æœæ˜¾ç¤º
        function updateResultDisplay() {
            const statusElement = document.getElementById('electionStatus');
            const contentElement = document.getElementById('resultContent');

            if (!electionData || !electionData.id) {
                displayNoElection();
                return;
            }

            const status = electionData.status || 'not_started';
            const isPublic = electionData.is_public || false;
            const finalResults = electionData.final_results || {};

            // æ›´æ–°çŠ¶æ€æ˜¾ç¤º
            updateStatusDisplay(statusElement, status);

            // æ ¹æ®çŠ¶æ€å’Œå…¬ç¤ºçŠ¶æ€æ˜¾ç¤ºä¸åŒå†…å®¹
            if (status === 'not_started') {
                displayNotStarted();
            } else if (status === 'ready' || status === 'voting') {
                displayVotingInProgress();
            } else if (status === 'finished') {
                displayCountingCompleted();
            } else if (status === 'revealed') {
                if (isPublic) {
                    displayFinalResults(finalResults);
                } else {
                    displayResultsNotPublic();
                }
            } else {
                displayCountingCompleted();
            }
        }

        function updateStatusDisplay(element, status) {
            const statusMap = {
                'not_started': { text: 'é€‰ä¸¾å°šæœªå¼€å§‹', color: '#ffc107', class: 'status-not-started' },
                'ready': { text: 'å‡†å¤‡å°±ç»ª', color: '#17a2b8', class: 'status-ready' },
                'voting': { text: 'æŠ•ç¥¨è¿›è¡Œä¸­', color: '#28a745', class: 'status-voting' },
                'finished': { text: 'è®¡ç¥¨å®Œæˆ', color: '#6c757d', class: 'status-finished' },
                'revealed': { text: 'ç»“æœå·²æ­ç¤º', color: '#9b59b6', class: 'status-revealed' }
            };

            const config = statusMap[status] || statusMap['not_started'];
            element.innerHTML = `çŠ¶æ€: <span class="status-badge ${config.class}">${config.text}</span>`;
        }

        function displayNoElection() {
            const contentElement = document.getElementById('resultContent');
            contentElement.innerHTML = `
                <div class="section">
                    <h3>ğŸ“­ æ²¡æœ‰æ´»åŠ¨çš„é€‰ä¸¾</h3>
                    <p>å½“å‰æ²¡æœ‰è¿›è¡Œä¸­çš„é€‰ä¸¾æ´»åŠ¨</p>
                    <p>è¯·ç­‰å¾…ç®¡ç†å‘˜åˆ›å»ºé€‰ä¸¾</p>
                    <div class="info-box">
                        <p><strong>å½“å‰çŠ¶æ€ï¼š</strong>æ— æ´»åŠ¨é€‰ä¸¾</p>
                        <p><strong>ä¸‹ä¸€æ­¥ï¼š</strong>ç®¡ç†å‘˜å°†åˆ›å»ºæ–°çš„é€‰ä¸¾æ´»åŠ¨</p>
                    </div>
                </div>
            `;
        }

        function displayNotStarted() {
            const contentElement = document.getElementById('resultContent');
            contentElement.innerHTML = `
                <div class="section">
                    <h3>â³ é€‰ä¸¾å°šæœªå¼€å§‹</h3>
                    <p>é€‰ä¸¾æ´»åŠ¨æ­£åœ¨å‡†å¤‡ä¸­ï¼Œè¯·è€å¿ƒç­‰å¾…</p>
                    <div class="info-box">
                        <p><strong>å½“å‰çŠ¶æ€ï¼š</strong>é€‰ä¸¾å‡†å¤‡ä¸­</p>
                        <p><strong>ä¸‹ä¸€æ­¥ï¼š</strong>ç®¡ç†å‘˜å°†åˆå§‹åŒ–åŠ å¯†ç³»ç»Ÿå¹¶å¼€å§‹æŠ•ç¥¨</p>
                    </div>
                </div>
            `;
        }

        function displayVotingInProgress() {
            const contentElement = document.getElementById('resultContent');
            const votes = electionData.votes || [];
            const totalVotes = votes.length;

            contentElement.innerHTML = `
                <div class="section">
                    <h3>ğŸ—³ï¸ æŠ•ç¥¨è¿›è¡Œä¸­</h3>
                    <p>é€‰ä¸¾æ­£åœ¨è¿›è¡Œä¸­ï¼Œç»“æœå°†åœ¨æŠ•ç¥¨ç»“æŸåå…¬ç¤º</p>
                    <p><strong>å½“å‰æŠ•ç¥¨äººæ•°ï¼š${totalVotes} äºº</strong></p>
                    <p><small>ä¸ºäº†ä¿æŠ¤æŠ•ç¥¨çš„å…¬æ­£æ€§ï¼ŒæŠ•ç¥¨æœŸé—´ä¸æ˜¾ç¤ºå®æ—¶ç¥¨æ•°ç»Ÿè®¡</small></p>
                </div>

                <div class="section">
                    <h3>ğŸ”’ ç»“æœä¿å¯†ä¸­</h3>
                    <p>æŠ•ç¥¨ç»“æœç›®å‰å¤„äºä¿å¯†çŠ¶æ€ï¼Œåªæœ‰ç®¡ç†å‘˜å¯ä»¥è¿›è¡Œè®¡ç¥¨æ“ä½œ</p>
                    <p>æœ€ç»ˆç»“æœå°†åœ¨æŠ•ç¥¨ç»“æŸåç”±ç®¡ç†å‘˜å…¬ç¤º</p>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-number">${totalVotes}</div>
                            <div>å½“å‰æŠ•ç¥¨æ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">${electionData.candidates ? electionData.candidates.length : 0}</div>
                            <div>å€™é€‰äººæ•°</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-number">è¿›è¡Œä¸­</div>
                            <div>é€‰ä¸¾çŠ¶æ€</div>
                        </div>
                    </div>
                </div>

                <div class="info-box">
                    <h4>ğŸ’¡ ç³»ç»Ÿè¯´æ˜</h4>
                    <p>æœ¬ç³»ç»Ÿé‡‡ç”¨PaillieråŒæ€åŠ å¯†æŠ€æœ¯ï¼Œç¡®ä¿ï¼š</p>
                    <ul style="text-align: left; display: inline-block;">
                        <li>æŠ•ç¥¨æœŸé—´ä¸æ³„éœ²ä»»ä½•ç¥¨æ•°ä¿¡æ¯</li>
                        <li>åªæœ‰æˆæƒç®¡ç†å‘˜å¯ä»¥æŸ¥çœ‹è®¡ç¥¨ç»“æœ</li>
                        <li>æœ€ç»ˆç»“æœéœ€è¦åŒå› ç´ éªŒè¯æ‰èƒ½å…¬ç¤º</li>
                        <li>ç¡®ä¿æŠ•ç¥¨çš„å…¬å¹³æ€§å’Œä¿å¯†æ€§</li>
                    </ul>
                </div>
            `;
        }

        function displayCountingCompleted() {
            const contentElement = document.getElementById('resultContent');
            const votes = electionData.votes || [];
            const totalVotes = votes.length;

            contentElement.innerHTML = `
                <div class="section">
                    <h3>ğŸ“Š è®¡ç¥¨å·²å®Œæˆ</h3>
                    <p>PaillieråŒæ€è®¡ç¥¨å·²ç»å®Œæˆï¼Œç­‰å¾…ç®¡ç†å‘˜æ­ç¤ºç»“æœ</p>
                    <p><strong>æ€»æŠ•ç¥¨äººæ•°ï¼š${totalVotes} äºº</strong></p>
                </div>

                <div class="section">
                    <h3>ğŸ” ç»“æœå¾…æ­ç¤º</h3>
                    <p>é€‰ä¸¾è®¡ç¥¨å·²ç»å®Œæˆï¼Œä½†ç»“æœå°šæœªæ­ç¤º</p>
                    <p>è¯·ç­‰å¾…ç®¡ç†å‘˜è¿›è¡ŒåŒå› ç´ éªŒè¯æ­ç¤ºç»“æœ</p>
                    <p><small>æ­ç¤ºåç®¡ç†å‘˜å¯ä»¥é€‰æ‹©æ˜¯å¦å…¬ç¤ºç»“æœ</small></p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">${totalVotes}</div>
                        <div>æ€»æŠ•ç¥¨æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${electionData.candidates ? electionData.candidates.length : 0}</div>
                        <div>å€™é€‰äººæ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${new Date().toLocaleDateString()}</div>
                        <div>è®¡ç¥¨æ—¥æœŸ</div>
                    </div>
                </div>

                <div class="info-box">
                    <h4>â³ ä¸‹ä¸€æ­¥æ“ä½œ</h4>
                    <p>ç®¡ç†å‘˜éœ€è¦åœ¨ <a href="/reveal">ç»“æœæ­ç¤ºé¡µé¢</a> è¿›è¡ŒåŒå› ç´ éªŒè¯ï¼Œç„¶åé€‰æ‹©æ˜¯å¦å…¬ç¤ºç»“æœã€‚</p>
                    <p>ä¸€æ—¦ç»“æœå…¬ç¤ºï¼Œæ‚¨å°†å¯ä»¥åœ¨æ­¤é¡µé¢æŸ¥çœ‹è¯¦ç»†çš„é€‰ä¸¾ç»“æœã€‚</p>
                </div>
            `;
        }

        function displayResultsNotPublic() {
            const contentElement = document.getElementById('resultContent');
            const votes = electionData.votes || [];
            const totalVotes = votes.length;
            const revealedAt = electionData.revealed_at ? new Date(electionData.revealed_at).toLocaleString() : 'æœªçŸ¥æ—¶é—´';

            contentElement.innerHTML = `
                <div class="section">
                    <h3>ğŸ” ç»“æœå·²æ­ç¤ºä½†æœªå…¬ç¤º</h3>
                    <p>é€‰ä¸¾ç»“æœå·²ç»é€šè¿‡åŒå› ç´ éªŒè¯è§£å¯†ï¼Œä½†ç®¡ç†å‘˜é€‰æ‹©æš‚ä¸å…¬ç¤º</p>
                    <p><strong>æ€»æŠ•ç¥¨äººæ•°ï¼š${totalVotes} äºº</strong></p>
                    <p><small>ç»“æœæ­ç¤ºæ—¶é—´ï¼š${revealedAt}</small></p>
                </div>

                <div class="section">
                    <h3>ğŸ”’ ç»“æœæš‚ä¸å…¬ç¤º</h3>
                    <p>ç®¡ç†å‘˜å·²é€‰æ‹©æš‚ä¸å…¬ç¤ºé€‰ä¸¾ç»“æœ</p>
                    <p>ç»“æœç›®å‰ä»…å¯¹ç®¡ç†å‘˜å¯è§</p>
                    <p><small>å¦‚æœç®¡ç†å‘˜é€‰æ‹©å…¬ç¤ºç»“æœï¼Œæ‚¨å°†å¯ä»¥åœ¨æ­¤æŸ¥çœ‹</small></p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">${totalVotes}</div>
                        <div>æ€»æŠ•ç¥¨æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${electionData.candidates ? electionData.candidates.length : 0}</div>
                        <div>å€™é€‰äººæ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">å·²æ­ç¤º</div>
                        <div>ç»“æœçŠ¶æ€</div>
                    </div>
                </div>

                <div class="info-box">
                    <h4>ğŸ’¡ è¯´æ˜</h4>
                    <p>ç®¡ç†å‘˜å¯èƒ½å› ä¸ºä»¥ä¸‹åŸå› é€‰æ‹©æš‚ä¸å…¬ç¤ºç»“æœï¼š</p>
                    <ul style="text-align: left; display: inline-block;">
                        <li>ç­‰å¾…æ‰€æœ‰ç›¸å…³äººå‘˜åˆ°åœº</li>
                        <li>è¿›è¡Œæœ€ç»ˆç»“æœç¡®è®¤</li>
                        <li>å®‰æ’æ­£å¼å…¬å¸ƒä»ªå¼</li>
                        <li>å…¶ä»–ç®¡ç†è€ƒè™‘</li>
                    </ul>
                    <p>è¯·è€å¿ƒç­‰å¾…ç®¡ç†å‘˜çš„æ­£å¼å…¬ç¤ºé€šçŸ¥ã€‚</p>
                </div>
            `;
        }

        function displayFinalResults(results) {
            const contentElement = document.getElementById('resultContent');
            const votes = electionData.votes || [];
            const candidates = electionData.candidates || [];
            const publicAt = electionData.public_at ? new Date(electionData.public_at).toLocaleString() : 'æœªçŸ¥æ—¶é—´';
            const revealedAt = electionData.revealed_at ? new Date(electionData.revealed_at).toLocaleString() : 'æœªçŸ¥æ—¶é—´';

            // è®¡ç®—æ€»ç¥¨æ•°å’Œæ‰¾åˆ°è·èƒœè€…
            const totalVotes = Object.values(results).reduce((sum, votes) => sum + votes, 0);
            const maxVotes = Math.max(...Object.values(results));
            const winners = Object.keys(results).filter(candidate => results[candidate] === maxVotes);

            let html = `
                <div class="winner-section">
                    <h2>ğŸ‰ é€‰ä¸¾ç»“æœå·²å…¬ç¤º</h2>
                    <p>æœ€ç»ˆç»“æœå·²ç»ç®¡ç†å‘˜å…¬ç¤ºï¼Œä»¥ä¸‹æ˜¯è¯¦ç»†ç¥¨æ•°ç»Ÿè®¡ï¼š</p>

                    ${winners.length === 1 ? `
                        <div class="winner-name">ğŸ† å½“é€‰ç­é•¿ï¼š${winners[0]} ğŸ†</div>
                    ` : `
                        <div class="winner-name" style="color: #856404;">âš–ï¸ å¹³å±€ï¼š${winners.join('ã€')} âš–ï¸</div>
                    `}
                    <p>æ€»ç¥¨æ•°ï¼š${totalVotes} ç¥¨ | å‚ä¸äººæ•°ï¼š${votes.length} äºº</p>
                    <p><small>æ­ç¤ºæ—¶é—´ï¼š${revealedAt} | å…¬ç¤ºæ—¶é—´ï¼š${publicAt}</small></p>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">${totalVotes}</div>
                        <div>æ€»ç¥¨æ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${votes.length}</div>
                        <div>å‚ä¸äººæ•°</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">${candidates.length}</div>
                        <div>å€™é€‰äººæ•°</div>
                    </div>
                </div>

                <div class="section">
                    <h3>ğŸ“ˆ è¯¦ç»†ç¥¨æ•°ç»Ÿè®¡</h3>
            `;

            // æŒ‰ç¥¨æ•°æ’åºæ˜¾ç¤º
            const sortedResults = Object.entries(results)
                .sort((a, b) => b[1] - a[1]);

            sortedResults.forEach(([candidate, votes]) => {
                const percentage = totalVotes > 0 ? ((votes / totalVotes) * 100).toFixed(1) : 0;
                const isWinner = votes === maxVotes && maxVotes > 0;

                html += `
                    <div class="result-item">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                            <h4 style="margin: 0; flex: 1;">${candidate}</h4>
                            <div style="font-weight: bold;">
                                ${votes} ç¥¨
                                ${isWinner ? '<span class="winner-badge">è·èƒœ</span>' : ''}
                            </div>
                        </div>
                        <div class="vote-bar">
                            <div class="vote-fill" style="width: ${percentage}%">
                                ${percentage}%
                            </div>
                        </div>
                    </div>
                `;
            });

            html += `
                </div>

                <div class="info-box">
                    <h4>âœ… ç»“æœéªŒè¯</h4>
                    <p>æ‚¨å¯ä»¥ä½¿ç”¨æŠ•ç¥¨éªŒè¯åŠŸèƒ½ç¡®è®¤æ‚¨çš„æŠ•ç¥¨æ˜¯å¦è¢«æ­£ç¡®è®¡å…¥ç»“æœï¼š</p>
                    <a href="/verify" class="btn btn-success">éªŒè¯æˆ‘çš„æŠ•ç¥¨</a>
                    <p><small>è¾“å…¥æ‚¨çš„æŠ•ç¥¨å‡­è¯å“ˆå¸Œå€¼å’Œå­¦å·/å·¥å·è¿›è¡ŒéªŒè¯</small></p>
                </div>

                <div class="info-box">
                    <h4>ğŸ” å®‰å…¨ç‰¹æ€§è¯´æ˜</h4>
                    <p>æœ¬ç³»ç»Ÿé‡‡ç”¨PaillieråŒæ€åŠ å¯†å’Œé˜ˆå€¼è§£å¯†æŠ€æœ¯ï¼Œç¡®ä¿ï¼š</p>
                    <ul style="text-align: left; display: inline-block;">
                        <li>æŠ•ç¥¨è¿‡ç¨‹å®Œå…¨åŠ å¯†ï¼Œä¿æŠ¤æŠ•ç¥¨éšç§</li>
                        <li>éœ€è¦å¯¼å‘˜å’Œå›¢æ”¯ä¹¦åŒæ–¹åˆä½œæ‰èƒ½è§£å¯†ç»“æœ</li>
                        <li>é˜²æ­¢å•æ–¹ç¯¡æ”¹æˆ–æå‰æŸ¥çœ‹ç»“æœ</li>
                        <li>ç¡®ä¿é€‰ä¸¾çš„å…¬å¹³æ€§å’Œå®‰å…¨æ€§</li>
                    </ul>
                </div>
            `;

            contentElement.innerHTML = html;

            // æ·»åŠ åŠ¨ç”»æ•ˆæœ
            setTimeout(() => {
                document.querySelectorAll('.vote-fill').forEach(fill => {
                    const width = fill.style.width;
                    fill.style.width = '0%';
                    setTimeout(() => {
                        fill.style.width = width;
                    }, 100);
                });
            }, 500);
        }

        // æ˜¾ç¤ºæ¶ˆæ¯
        function showMessage(message, type) {
            const element = document.getElementById(type === 'error' ? 'errorMessage' : 'successMessage');
            element.textContent = message;
            element.style.display = 'block';

            setTimeout(() => {
                element.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>